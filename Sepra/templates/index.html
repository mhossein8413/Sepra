<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø³Ù¾Ø±Ø§ | Ø³Ø§ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…Ø³ÛŒØ±â€ŒÛŒØ§Ø¨ÛŒ</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">

    <!-- Leaflet CSS & JS Ø¨Ø±Ø§ÛŒ Ù†Ù‚Ø´Ù‡ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¯Ø±Ù† ÙØ§Ø±Ø³ÛŒ -->
    <link href="https://fonts.googleapis.com/css2?family=Shabnam:wght@300;400;600;700&family=Vazirmatn:wght@300;400;600;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Shabnam", "Vazirmatn", sans-serif;
            background: radial-gradient(circle at top, #fffdfb 0, #faf4ee 40%, #f4ece4 100%);
            color: #2f2f2f;
        }

        .navbar-custom {
            background: #ffffffee;
            backdrop-filter: blur(14px);
            box-shadow: 0 8px 26px rgba(0,0,0,0.06);
            border-bottom: 1px solid #f1e3d6;
        }

        .navbar-brand {
            font-weight: 900;
            font-size: 30px;
            color: #3b2f2a !important;
            line-height: 1.2;
        }

        .navbar-subtitle {
            font-size: 13px;
            color: #8b7a6c;
            margin-top: -4px;
        }

        .top-taxi {
            width: 260px;
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 6;
            filter: drop-shadow(0 14px 32px rgba(0,0,0,0.28));
        }

        .hero-section {
            padding: 90px 0 20px 0;
        }

        .hero-title {
            font-size: 34px;
            font-weight: 900;
            color: #3b2f2a;
            margin-bottom: 10px;
        }

        .hero-text {
            font-size: 15px;
            color: #6b5a4c;
            line-height: 1.9;
        }

        .form-card {
            background: #ffffff;
            border-radius: 22px;
            padding: 24px 22px;
            box-shadow: 0 14px 40px rgba(0,0,0,0.08);
            border: 1px solid #f0e2d5;
        }

        .form-title {
            font-size: 18px;
            font-weight: 800;
            text-align: center;
            margin-bottom: 16px;
        }

        .form-control {
            border-radius: 12px;
            border: 1px solid #e3d6c8;
            background: #fdf8f3;
            height: 46px;
        }

        .btn-glow {
            background: linear-gradient(135deg, #d1a97c, #c28a5a);
            color: #ffffff;
            border-radius: 14px;
            padding: 11px;
            font-size: 16px;
            font-weight: 700;
            border: none;
            box-shadow: 0 12px 30px rgba(176,128,80,0.45);
            cursor: pointer;
        }

        .btn-glow:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 10px 0;
        }

        .route-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 18px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.06);
            border: 1px solid #f0e2d5;
            margin-bottom: 14px;
        }

        .route-title {
            font-size: 16px;
            font-weight: 800;
            color: #3b2f2a;
        }

        .route-meta {
            font-size: 13px;
            color: #7a6a5c;
            margin-top: 8px;
        }

        .map-card {
            background: #ffffff;
            border-radius: 22px;
            padding: 18px;
            box-shadow: 0 14px 40px rgba(0,0,0,0.08);
            border: 1px solid #f0e2d5;
        }

        #map {
            height: 350px;
            border-radius: 18px;
            z-index: 1;
        }

        .transport-row {
            display: flex;
            align-items: center;
            gap: 18px;
            margin-top: 18px;
        }

        .transport-row img {
            width: 64px;
            filter: drop-shadow(0 6px 12px rgba(0,0,0,0.18));
        }

        .info-section {
            margin-top: 34px;
            margin-bottom: 18px;
        }

        .info-title {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 6px;
            color: #3b2f2a;
        }

        .info-text {
            font-size: 14px;
            color: #6b5a4c;
            line-height: 2;
        }

        .footer {
            border-top: 1px solid #ead9c8;
            margin-top: 20px;
            padding: 12px 0;
            font-size: 12px;
            color: #8b7a6c;
            text-align: center;
        }

        .legend {
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            margin-left: 5px;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .top-taxi { display: none; }
            #map { height: 300px; }
        }
    </style>
</head>

<body>

<!-- Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ -->
<nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container">
        <a class="navbar-brand" href="#">
            Ø³Ù¾Ø±Ø§
            <div class="navbar-subtitle">Ø³Ø§ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…Ø³ÛŒØ±â€ŒÛŒØ§Ø¨ÛŒ</div>
        </a>
    </div>
</nav>

<div class="container position-relative">

    <!-- ØªØ§Ú©Ø³ÛŒ Ú©Ø§Ø±ØªÙˆÙ†ÛŒ Ø¨Ø²Ø±Ú¯ Ø¬Ø§ÛŒ Ú©ÛŒÙ -->
    <img class="top-taxi" src="https://cdn-icons-png.flaticon.com/512/3097/3097144.png">

    <div class="row hero-section align-items-start">

        <div class="col-md-6 mb-4">
            <h1 class="hero-title">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø³ÛŒØ±ØŒ Ø³Ø§Ø¯Ù‡â€ŒØªØ± Ø§Ø² Ù‡Ù…ÛŒØ´Ù‡</h1>
            <p class="hero-text">
                Ø¨Ø§ Ø³Ù¾Ø±Ø§ØŒ Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ø´Ù‡Ø±ÛŒ Ø±Ø§ Ø³Ø±ÛŒØ¹ØŒ Ø¯Ù‚ÛŒÙ‚ Ùˆ Ø¨Ø¯ÙˆÙ† Ù¾ÛŒÚ†ÛŒØ¯Ú¯ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ù†.
            </p>

            <div class="form-card mt-3">
                <div class="form-title">Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø³ÛŒØ±</div>

                <form id="routeForm">
                    <div class="mb-3">
                        <label class="form-label">
                            <strong>ğŸ“ Ù…Ø¨Ø¯Ø£</strong>
                            <small class="text-muted d-block mt-1">
                                Ø¢Ø¯Ø±Ø³ØŒ Ù…Ø®ØªØµØ§Øª ÛŒØ§ Ù†Ø§Ù… Ù…Ú©Ø§Ù† (Ù…Ø«Ø§Ù„: 30.285424, 57.012086 ÛŒØ§ Ù¾Ø§Ø±Ú© Ù…Ù„Øª)
                            </small>
                        </label>
                        <input name="start" class="form-control" 
                               placeholder="Ù…Ø«Ø§Ù„: 30.285424, 57.012086 ÛŒØ§ Ù¾Ø§Ø±Ú© Ù…Ù„Øª" 
                               required
                               id="startInput">
                        <div class="form-text text-muted small">
                            Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ù…Ø®ØªØµØ§Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ù†Ø§Ù… Ù…Ú©Ø§Ù†
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <strong>ğŸ Ù…Ù‚ØµØ¯</strong>
                            <small class="text-muted d-block mt-1">
                                Ø¢Ø¯Ø±Ø³ØŒ Ù…Ø®ØªØµØ§Øª ÛŒØ§ Ù†Ø§Ù… Ù…Ú©Ø§Ù† (Ù…Ø«Ø§Ù„: 30.257819, 57.103706 ÛŒØ§ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¨Ø§Ù‡Ù†Ø±)
                            </small>
                        </label>
                        <input name="end" class="form-control" 
                               placeholder="Ù…Ø«Ø§Ù„: 30.257819, 57.103706 ÛŒØ§ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø´Ù‡ÛŒØ¯ Ø¨Ø§Ù‡Ù†Ø±" 
                               required
                               id="endInput">
                        <div class="form-text text-muted small">
                            Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ù…Ø®ØªØµØ§Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ù†Ø§Ù… Ù…Ú©Ø§Ù†
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ğŸ•’ Ø²Ù…Ø§Ù† Ø­Ø±Ú©Øª (Ø³Ø§Ø¹Øª:Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                        <input name="start_time" class="form-control" 
                               value="8:20" 
                               placeholder="Ù…Ø«Ø§Ù„: 8:20 ÛŒØ§ 14:30" 
                               required
                               pattern="\d{1,2}:\d{2}">
                        <div class="form-text text-muted small">
                            Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ø³ÙØ± (Ø¨ÛŒÙ† 8:00 ØªØ§ 20:00 Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ØªÙˆØ¨ÙˆØ³)
                        </div>
                    </div>

                    <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ù…Ø®ØªØµØ§Øª Ø³Ø±ÛŒØ¹ -->
                    <div class="mb-3">
                        <label class="form-label">ğŸ“Œ Ù…Ø®ØªØµØ§Øª Ù†Ù…ÙˆÙ†Ù‡ Ø³Ø±ÛŒØ¹:</label>
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                    onclick="setSample('start', 'Ù¾Ø§Ø±Ú© Ù…Ù„Øª', 'Ù¾Ø§Ø±Ú© Ù…Ù„Øª')">
                                Ù¾Ø§Ø±Ú© Ù…Ù„Øª
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                    onclick="setSample('start', 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¨Ø§Ù‡Ù†Ø±', 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¨Ø§Ù‡Ù†Ø±')">
                                Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¨Ø§Ù‡Ù†Ø±
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                    onclick="setSample('start', 'Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø¯Ø§', 'Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø¯Ø§')">
                                Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø¯Ø§
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                    onclick="setSample('start', 'Ù…Ø®ØªØµØ§Øª ØªØ³Øª', '30.285424, 57.012086')">
                                Ù…Ø®ØªØµØ§Øª ØªØ³Øª
                            </button>
                        </div>
                        
                        <div class="d-flex flex-wrap gap-2">
                            <button type="button" class="btn btn-sm btn-outline-success" 
                                    onclick="setSample('end', 'ÙØ±ÙˆØ¯Ú¯Ø§Ù‡ Ú©Ø±Ù…Ø§Ù†', 'ÙØ±ÙˆØ¯Ú¯Ø§Ù‡ Ú©Ø±Ù…Ø§Ù†')">
                                ÙØ±ÙˆØ¯Ú¯Ø§Ù‡
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-success" 
                                    onclick="setSample('end', 'ØªØ±Ù…ÛŒÙ†Ø§Ù„', 'ØªØ±Ù…ÛŒÙ†Ø§Ù„ Ù…Ø³Ø§ÙØ±Ø¨Ø±ÛŒ')">
                                ØªØ±Ù…ÛŒÙ†Ø§Ù„
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-success" 
                                    onclick="setSample('end', 'Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ø§ÙØ¶Ù„ÛŒ', 'Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ø§ÙØ¶Ù„ÛŒ')">
                                Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ø§ÙØ¶Ù„ÛŒ
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-success" 
                                    onclick="setSample('end', 'Ù…Ø®ØªØµØ§Øª ØªØ³Øª', '30.257819, 57.103706')">
                                Ù…Ø®ØªØµØ§Øª ØªØ³Øª
                            </button>
                        </div>
                    </div>

                    <div class="loading" id="loading">
                        <div class="spinner-border text-warning" role="status">
                            <span class="visually-hidden">Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡...</span>
                        </div>
                        <p class="mt-2">Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø³ÛŒØ±...</p>
                    </div>

                    <button type="submit" class="btn btn-glow w-100" id="calculateBtn">
                        ğŸš€ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³ÛŒØ±
                    </button>
                </form>
            </div>

            <!-- Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„ -->
            <div class="transport-row">
                <img src="https://cdn-icons-png.flaticon.com/512/743/743131.png" alt="ØªØ§Ú©Ø³ÛŒ">
                <img src="https://cdn-icons-png.flaticon.com/512/61/61212.png" alt="Ø§ØªÙˆØ¨ÙˆØ³">
                <img src="https://cdn-icons-png.flaticon.com/512/1048/1048313.png" alt="Ù…ÙˆØªÙˆØ±">
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <!-- Ù…Ø³ÛŒØ± Ø§ÙˆÙ„ -->
            <div class="route-card" id="route1">
                <div class="route-title">Ù…Ø³ÛŒØ± Ø§ØµÙ„ÛŒ</div>
                <div class="route-meta" id="route1-time">Ø²Ù…Ø§Ù† Ø±Ø³ÛŒØ¯Ù†: â€”</div>
                <div class="route-meta" id="route1-cost">Ù‡Ø²ÛŒÙ†Ù‡: â€”</div>
                <div class="route-meta" id="route1-mode">Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±: â€”</div>
            </div>

            <!-- Ù…Ø³ÛŒØ± Ø¯ÙˆÙ… -->
            <div class="route-card" id="route2">
                <div class="route-title">Ù…Ø³ÛŒØ± Ø¯ÙˆÙ… (Ø§Ø³Ù†Ù¾)</div>
                <div class="route-meta" id="route2-time">Ø²Ù…Ø§Ù† Ø±Ø³ÛŒØ¯Ù†: â€”</div>
                <div class="route-meta" id="route2-cost">Ù‡Ø²ÛŒÙ†Ù‡: â€”</div>
                <div class="route-meta" id="route2-mode">Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±: â€”</div>
            </div>

            <!-- Ù†Ù‚Ø´Ù‡ -->
            <div class="map-card mt-3">
                <div class="form-title">Ù†Ù‚Ø´Ù‡ Ù…Ø³ÛŒØ± Ø´Ù‡Ø± Ú©Ø±Ù…Ø§Ù†</div>
                <div id="map"></div>
                <div class="legend" id="mapLegend" style="display: none;">
                    <h6>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø±Ù†Ú¯â€ŒÙ‡Ø§:</h6>
                    <div id="legendItems"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª Ù¾Ø§ÛŒÛŒÙ†ÛŒ -->
    <div class="info-section">
        <div class="info-title">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø³Ù¾Ø±Ø§</div>
        <p class="info-text">
            Ø³Ù¾Ø±Ø§ ÛŒÚ© Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ø´Ù‡Ø±ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¨Ø§ Ù‡Ø¯Ù Ø³Ø§Ø¯Ù‡â€ŒØªØ± Ú©Ø±Ø¯Ù† Ø±ÙØªâ€ŒÙˆØ¢Ù…Ø¯ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡.
            Ø¨Ø§ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù…Ø¨Ø¯Ø£ØŒ Ù…Ù‚ØµØ¯ Ùˆ Ø²Ù…Ø§Ù† Ø­Ø±Ú©ØªØŒ Ø³Ù¾Ø±Ø§ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø³ÛŒØ± Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ø±Ø§ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒ Ø´Ù‡Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.
        </p>
    </div>

    <!-- ÙÙˆØªØ± -->
    <div class="footer">
        Ú©Ù„ÛŒÙ‡ Ø­Ù‚ÙˆÙ‚ Ù…ØªØ¹Ù„Ù‚ Ø¨Ù‡ Ø³Ø§ÛŒØª Ø³Ù¾Ø±Ø§ Ø§Ø³Øª Ùˆ Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ú©Ù¾ÛŒâ€ŒØ¨Ø±Ø¯Ø§Ø±ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø² Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.
    </div>
</div>

<script>
    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ
    let map = null;
    let routeLayers = {
        'walk': [],
        'bus': [],
        'taxi': [],
        'snap': []
    };
    let markers = [];
    
    // Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±
    const routeColors = {
        'walk': '#4CAF50',  // Ø³Ø¨Ø²
        'bus': '#2196F3',   // Ø¢Ø¨ÛŒ
        'taxi': '#FF9800',  // Ù†Ø§Ø±Ù†Ø¬ÛŒ
        'snap': '#E91E63'   // ØµÙˆØ±ØªÛŒ
    };
    
    // Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ÙˆØ§Ø¹ Ù…Ø³ÛŒØ±
    const routeNames = {
        'walk': 'Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ',
        'bus': 'Ø§ØªÙˆØ¨ÙˆØ³',
        'taxi': 'ØªØ§Ú©Ø³ÛŒ',
        'snap': 'Ø§Ø³Ù†Ù¾'
    };
    
    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ¹
    function setSample(field, name, value) {
        const input = document.getElementById(field === 'start' ? 'startInput' : 'endInput');
        input.value = value;
        
        showMessage(`${field === 'start' ? 'Ù…Ø¨Ø¯Ø£' : 'Ù…Ù‚ØµØ¯'} ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯: ${name}`, 'success');
        
        if (field === 'start') {
            document.getElementById('endInput').focus();
        } else {
            document.getElementById('startInput').focus();
        }
    }
    
    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
    function showMessage(text, type = 'info') {
        const existingMsg = document.getElementById('tempMessage');
        if (existingMsg) {
            existingMsg.remove();
        }
        
        const messageDiv = document.createElement('div');
        messageDiv.id = 'tempMessage';
        messageDiv.className = `alert alert-${type} alert-dismissible fade show mt-2`;
        messageDiv.innerHTML = `
            ${text}
            <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
        `;
        
        const form = document.getElementById('routeForm');
        form.parentNode.insertBefore(messageDiv, form.nextSibling);
        
        setTimeout(() => {
            if (messageDiv.parentNode) {
                messageDiv.remove();
            }
        }, 5000);
    }
    
    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù…
    document.getElementById('routeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        processRouteForm();
    });
    
    // ØªØ§Ø¨Ø¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ±Ù…
    async function processRouteForm() {
        const form = document.getElementById('routeForm');
        const formData = new FormData(form);
        const calculateBtn = document.getElementById('calculateBtn');
        const loading = document.getElementById('loading');
        
        calculateBtn.disabled = true;
        calculateBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡...';
        loading.style.display = 'block';
        
        try {
            const response = await fetch('/route', {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                throw new Error(`Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±: ${response.status}`);
            }
            
            const data = await response.json();
            console.log("âœ… Ù¾Ø§Ø³Ø® Ø¯Ø±ÛŒØ§ÙØªÛŒ:", data);
            
            if (data.error) {
                throw new Error(data.error);
            }
            
            updateResults(data);
            
            if (data.map_data) {
                drawRouteOnMap(data.map_data);
            }
            
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø§:', error);
            showMessage(`Ø®Ø·Ø§: ${error.message}`, 'danger');
        } finally {
            calculateBtn.disabled = false;
            calculateBtn.innerHTML = 'ğŸš€ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³ÛŒØ±';
            loading.style.display = 'none';
        }
    }
    
    // ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†ØªØ§ÛŒØ¬
    function updateResults(data) {
        if (data.route1) {
            document.getElementById('route1-time').textContent = `Ø²Ù…Ø§Ù† Ø±Ø³ÛŒØ¯Ù†: ${data.route1.time}`;
            document.getElementById('route1-cost').textContent = `Ù‡Ø²ÛŒÙ†Ù‡: ${data.route1.cost}`;
            document.getElementById('route1-mode').textContent = `Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±: ${data.route1.mode}`;
        }
        
        if (data.route2) {
            document.getElementById('route2-time').textContent = `Ø²Ù…Ø§Ù† Ø±Ø³ÛŒØ¯Ù†: ${data.route2.time}`;
            document.getElementById('route2-cost').textContent = `Ù‡Ø²ÛŒÙ†Ù‡: ${data.route2.cost}`;
            document.getElementById('route2-mode').textContent = `Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±: ${data.route2.mode}`;
        }
        
        showMessage('âœ… Ù…Ø³ÛŒØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯!', 'success');
    }
    
    // ØªØ§Ø¨Ø¹ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù†Ù‚Ø´Ù‡
    function initMap() {
        if (map) {
            map.remove();
        }
        
        // Ù…Ø±Ú©Ø² Ø¨Ø± Ø±ÙˆÛŒ Ú©Ø±Ù…Ø§Ù†
        map = L.map('map').setView([30.2839, 57.0834], 13);
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„Ø§ÛŒÙ‡ OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);
        
        console.log("ğŸ—ºï¸ Ù†Ù‚Ø´Ù‡ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯");
    }
    
    // ØªØ§Ø¨Ø¹ Ø±Ø³Ù… Ù…Ø³ÛŒØ± Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡
    function drawRouteOnMap(mapData) {
        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
        clearMap();
        
        if (!mapData) {
            console.error("âŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯");
            return;
        }
        
        console.log("ğŸ¨ Ø´Ø±ÙˆØ¹ Ø±Ø³Ù… Ù…Ø³ÛŒØ± Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡");
        console.log("Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡:", mapData);
        
        // Ù†Ù…Ø§ÛŒØ´ Ù†Ø´Ø§Ù†Ú¯Ø±Ù‡Ø§ÛŒ Ù…Ø¨Ø¯Ø£ Ùˆ Ù…Ù‚ØµØ¯
        if (mapData.markers) {
            if (mapData.markers.start && mapData.markers.start.length > 0) {
                const startCoords = mapData.markers.start[0];
                const startMarker = L.marker(startCoords, {
                    icon: L.icon({
                        iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
                        iconSize: [40, 40],
                        iconAnchor: [20, 40],
                        popupAnchor: [0, -40]
                    })
                }).addTo(map);
                startMarker.bindPopup("<b>ğŸ“ Ù…Ø¨Ø¯Ø£</b>").openPopup();
                markers.push(startMarker);
            }
            
            if (mapData.markers.end && mapData.markers.end.length > 0) {
                const endCoords = mapData.markers.end[0];
                const endMarker = L.marker(endCoords, {
                    icon: L.icon({
                        iconUrl: 'https://cdn-icons-png.flaticon.com/512/447/447031.png',
                        iconSize: [40, 40],
                        iconAnchor: [20, 40],
                        popupAnchor: [0, -40]
                    })
                }).addTo(map);
                endMarker.bindPopup("<b>ğŸ Ù…Ù‚ØµØ¯</b>");
                markers.push(endMarker);
            }
        }
        
        // Ø±Ø³Ù… Ù‡Ø± Ù†ÙˆØ¹ Ù…Ø³ÛŒØ± Ø¨Ø§ Ø±Ù†Ú¯ Ù…ØªÙØ§ÙˆØª
        let bounds = [];
        
        // Ø§ÙˆÙ„ Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ø¯ÛŒØ¬Ú©Ø³ØªØ±Ø§ (walk, bus, taxi)
        ['walk', 'bus', 'taxi'].forEach(mode => {
            if (mapData[mode] && Array.isArray(mapData[mode])) {
                console.log(`ğŸ¯ Ø±Ø³Ù… ${mode} Ø¨Ø§ ${mapData[mode].length} Ø¨Ø®Ø´`);
                
                mapData[mode].forEach((segment, index) => {
                    if (segment && segment.length > 1) {
                        const polyline = L.polyline(segment, {
                            color: routeColors[mode] || '#000000',
                            weight: 6,
                            opacity: 0.8,
                            lineCap: 'round',
                            lineJoin: 'round'
                        }).addTo(map);
                        
                        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† popup
                        polyline.bindPopup(`<b>${routeNames[mode] || mode}</b><br>Ø¨Ø®Ø´ ${index + 1}`);
                        
                        routeLayers[mode].push(polyline);
                        
                        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø®ØªØµØ§Øª Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ bounds
                        bounds = bounds.concat(segment);
                    }
                });
            }
        });
        
        // Ø±Ø³Ù… Ù…Ø³ÛŒØ± Ø§Ø³Ù†Ù¾
        if (mapData.snap && Array.isArray(mapData.snap) && mapData.snap[0]) {
            console.log("ğŸ¯ Ø±Ø³Ù… Ù…Ø³ÛŒØ± Ø§Ø³Ù†Ù¾");
            const snapSegment = mapData.snap[0];
            
            if (snapSegment && snapSegment.length > 1) {
                const polyline = L.polyline(snapSegment, {
                    color: routeColors['snap'],
                    weight: 6,
                    opacity: 0.8,
                    dashArray: '10, 10',
                    lineCap: 'round',
                    lineJoin: 'round'
                }).addTo(map);
                
                polyline.bindPopup("<b>ğŸš• Ù…Ø³ÛŒØ± Ø§Ø³Ù†Ù¾</b><br>Ù…Ø³ÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ… ØªØ§Ú©Ø³ÛŒ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ");
                
                routeLayers['snap'].push(polyline);
                bounds = bounds.concat(snapSegment);
            }
        }
        
        // ØªÙ†Ø¸ÛŒÙ… view Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ Ù…Ø³ÛŒØ±Ù‡Ø§
        if (bounds.length > 0) {
            try {
                const latLngBounds = L.latLngBounds(bounds);
                map.fitBounds(latLngBounds, { padding: [50, 50] });
            } catch (e) {
                console.warn("Ø®Ø·Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ… bounds:", e);
                map.setView([30.2839, 57.0834], 13);
            }
        }
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø±Ù†Ú¯â€ŒÙ‡Ø§
        createLegend(mapData);
        
        console.log("âœ… Ù†Ù‚Ø´Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø±Ø³Ù… Ø´Ø¯");
    }
    
    // ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø±Ù†Ú¯â€ŒÙ‡Ø§
    function createLegend(mapData) {
        const legend = document.getElementById('mapLegend');
        const legendItems = document.getElementById('legendItems');
        
        legendItems.innerHTML = '';
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø¯Ø§Ù… Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„ Ø¯Ø± Ù†Ù‚Ø´Ù‡ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù†Ø¯
        const existingModes = [];
        
        if (mapData.walk && mapData.walk.length > 0) existingModes.push('walk');
        if (mapData.bus && mapData.bus.length > 0) existingModes.push('bus');
        if (mapData.taxi && mapData.taxi.length > 0) existingModes.push('taxi');
        if (mapData.snap && mapData.snap.length > 0) existingModes.push('snap');
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
        existingModes.forEach(mode => {
            const item = document.createElement('div');
            item.className = 'legend-item';
            item.innerHTML = `
                <div class="legend-color" style="background-color: ${routeColors[mode]};"></div>
                <span>${routeNames[mode] || mode}</span>
            `;
            legendItems.appendChild(item);
        });
        
        // Ù†Ù…Ø§ÛŒØ´ Ø±Ø§Ù‡Ù†Ù…Ø§ Ø§Ú¯Ø± Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù…Ø³ÛŒØ± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
        if (existingModes.length > 0) {
            legend.style.display = 'block';
        } else {
            legend.style.display = 'none';
        }
    }
    
    // ØªØ§Ø¨Ø¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†Ù‚Ø´Ù‡
    function clearMap() {
        // Ø­Ø°Ù Ù‡Ù…Ù‡ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§
        Object.values(routeLayers).forEach(layerList => {
            layerList.forEach(layer => {
                if (layer && map.hasLayer(layer)) {
                    map.removeLayer(layer);
                }
            });
        });
        
        
        // Ø­Ø°Ù Ù‡Ù…Ù‡ Ù†Ø´Ø§Ù†Ú¯Ø±Ù‡Ø§
        markers.forEach(marker => {
            if (marker && map.hasLayer(marker)) {
                map.removeLayer(marker);
            }
        });
        
        markers = [];
        
        // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§
        routeLayers = {
            'walk': [],
            'bus': [],
            'taxi': [],
            'snap': []
        };
        
        // Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø±Ø§Ù‡Ù†Ù…Ø§
        document.getElementById('mapLegend').style.display = 'none';
    }
    
    // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    window.addEventListener('load', function() {
        // ØªÙ†Ø¸ÛŒÙ… Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶
        document.getElementById('startInput').value = "30.285424, 57.012086";
        document.getElementById('endInput').value = "30.257819, 57.103706";
        
        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù†Ù‚Ø´Ù‡
        initMap();
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ù…Ø®ØªØµØ§Øª
        const guideDiv = document.createElement('div');
        guideDiv.className = 'alert alert-info mt-3 small';
        guideDiv.innerHTML = `
            <h6>ğŸ“ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ÙˆØ±ÙˆØ¯:</h6>
            <ul class="mb-0">
                <li>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ <strong>Ù…Ø®ØªØµØ§Øª</strong> ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯: <code>Ø¹Ø±Ø¶ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ, Ø·ÙˆÙ„ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ</code></li>
                <li>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ <strong>Ù†Ø§Ù… Ù…Ú©Ø§Ù†</strong> ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯: Ù…Ø§Ù†Ù†Ø¯ "Ù¾Ø§Ø±Ú© Ù…Ù„Øª" ÛŒØ§ "Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¨Ø§Ù‡Ù†Ø±"</li>
                <li>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ <strong>Ø¢Ø¯Ø±Ø³</strong> ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯: Ù…Ø§Ù†Ù†Ø¯ "Ø®ÛŒØ§Ø¨Ø§Ù† Ø´Ø±ÛŒØ¹ØªÛŒ Ú©Ø±Ù…Ø§Ù†"</li>
                <li>Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ú©Ø±Ù…Ø§Ù†: Ø¹Ø±Ø¶ Û²Û¹-Û³Û±ØŒ Ø·ÙˆÙ„ ÛµÛ¶-ÛµÛ¸</li>
            </ul>
        `;
        
        const container = document.querySelector('.container');
        const heroSection = document.querySelector('.hero-section');
        container.insertBefore(guideDiv, heroSection.nextSibling);
    });
</script>
</body>
</html>